# ğŸš€ CRM Design Quick Reference Card
*Keep this open while building with Claude Code*

---

## âš¡ BEFORE YOU START (Every Time!)

```bash
âœ“ Check schema: tables, required fields, enums, foreign keys
âœ“ Check RLS: who owns data, what's shared, user roles  
âœ“ Check UI: existing patterns in /components folder
âœ“ Mobile first: iPad is primary device
```

---

## ğŸ“ CREATING FORMS

### Must Have:
- [ ] **Required fields** â†’ `*` indicator + NOT NULL in schema
- [ ] **Yup validation** â†’ matches EXACT database constraints  
- [ ] **RLS filtering** â†’ dropdowns show ONLY user's accessible data
- [ ] **Touch targets** â†’ 44px minimum (use `h-11` for inputs)
- [ ] **Error display** â†’ Field-specific messages, not generic

### Quick Wins:
```tsx
// Good validation message
"Organization is required" âœ…
// Bad validation message  
"Please fill this field" âŒ

// Good RLS handling
organizations.filter(org => org.owner_user_id === userId) âœ…
// Bad RLS handling
organizations // Shows all orgs âŒ
```

---

## ğŸ“Š DISPLAYING DATA (Tables/Lists)

### Must Have:
- [ ] **Soft delete filter** â†’ `WHERE deleted_at IS NULL`
- [ ] **RLS joins** â†’ Only join accessible related data
- [ ] **Human readable** â†’ Show `organization.name` not `organization_id`
- [ ] **Pagination** â†’ LIMIT 20/50/100 with offset
- [ ] **Mobile view** â†’ Priority columns + expandable rows

### Performance Checklist:
```sql
-- Always include these:
WHERE deleted_at IS NULL
ORDER BY created_at DESC  
LIMIT 20 OFFSET 0
-- Index foreign keys & filtered columns!
```

---

## âœï¸ EDITING RECORDS

### Must Have:
- [ ] **Check ownership** â†’ Can user edit this record?
- [ ] **Readonly fields** â†’ id, created_at, created_by NEVER editable
- [ ] **Update tracking** â†’ Set updated_at = NOW(), updated_by = userId
- [ ] **Optimistic UI** â†’ Show pending, rollback on error
- [ ] **Preserve relations** â†’ Check impacts before changes

### RLS Edit Check:
```tsx
// Before showing edit button
if (record.created_by === userId || isAdmin) { 
  showEditButton() 
}
```

---

## ğŸ—‘ï¸ DELETING (Soft Delete Only!)

### Must Have:
- [ ] **Soft delete** â†’ `deleted_at = NOW()` (NEVER hard DELETE)
- [ ] **Check dependencies** â†’ Warn about related records
- [ ] **RLS delete** â†’ Verify permission before allowing
- [ ] **Immediate UI** â†’ Hide from view instantly
- [ ] **Undo option** â†’ 5-second undo toast

---

## ğŸ¨ CONSISTENCY RULES

### Component Usage:
```
âœ… ALLOWED (use freely):
Button, Card, Input, Select, Textarea, Form, Label, Checkbox

âŒ BANNED (don't use):
Badge, Avatar, Separator, Skeleton, Tooltip, Hover-card

ğŸ”„ CONDITIONAL (need justification):
Dialog, Tabs, Switch, Radio-group, Table, Slider
```

### Standard Patterns:
```tsx
// Loading states
<Spinner /> for actions
<Skeleton /> for initial load

// Error display  
<Toast /> for transient (auto-dismiss)
<Alert /> for important (stays visible)

// Success feedback
toast.success("Contact created")

// Empty states
<EmptyState 
  message="No contacts yet"
  action={<Button>Add First Contact</Button>}
/>
```

---

## ğŸ”´ CRITICAL: Never Forget!

1. **Schema is law** â†’ UI must match database EXACTLY
2. **RLS is security** â†’ ALWAYS filter by user access  
3. **Soft delete only** â†’ NEVER hard delete data
4. **Mobile first** â†’ Test on iPad viewport (768px)
5. **TypeScript strict** â†’ NO 'any' types ever

---

## ğŸš¦ Quick Validation

Before committing, ask:
- **Works offline?** â†’ Optimistic updates + retry logic
- **Handles errors?** â†’ Both validation AND permission errors  
- **Follows patterns?** â†’ Check similar components first
- **Touch friendly?** â†’ 44px targets, no hover-only features
- **Fast enough?** â†’ <500ms response for all actions

---

## ğŸ’¬ Claude Code Prompts

### Creating:
```
"Build [entity] form:
- Required: [fields from schema]
- RLS: Filter [related entity] by user access  
- Mobile: 44px inputs, 16px fonts
- Pattern: Copy from [ExistingForm.tsx]"
```

### Listing:
```
"Create [entity] table:
- Query: Include deleted_at filter
- Columns: [priority fields for mobile]
- RLS: Join only user's organizations
- Pattern: Copy from ContactsTable.tsx"
```

### Debugging:
```
"Debug RLS issue:
- Entity: [table name]
- User role: [admin/user]
- Expected: [what should happen]
- Actual: [what's happening]
- Check: RLS policies and ownership"
```

---

## ğŸ“ Quick Links

- **Schema**: `/docs/DATABASE_SCHEMA.md`
- **Components**: `/src/components/[entity]/`
- **Validation**: `/src/types/validation.ts`
- **RLS Patterns**: `/supabase/migrations/`
- **UI Library**: [shadcn/ui docs](https://ui.shadcn.com)

---

*Version 1.0 | Print and keep visible while coding!*