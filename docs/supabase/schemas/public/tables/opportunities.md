# opportunities

## Columns

| Column | Type | Nullable | Default | Comment |
|--------|------|----------|---------|---------|
| id | uuid | NO | gen_random_uuid() | |
| name | text | NO | | |
| priority | priority_level | YES | 'medium'::priority_level | |
| estimated_value | numeric | YES | | |
| estimated_close_date | date | YES | | |
| actual_close_date | date | YES | | |
| probability | integer | YES | 0 | |
| contact_id | uuid | YES | | Contact person for this opportunity. Can be NULL for organization-level opportunities where no specific contact is identified yet. |
| organization_id | uuid | NO | | |
| principal_organization_id | uuid | YES | | |
| distributor_organization_id | uuid | YES | | |
| description | text | YES | | |
| next_action | text | YES | | |
| next_action_date | date | YES | | |
| competition | text | YES | | |
| decision_criteria | text | YES | | |
| notes | text | YES | | |
| created_at | timestamptz | YES | now() | |
| updated_at | timestamptz | YES | now() | |
| created_by | uuid | YES | | |
| updated_by | uuid | YES | | |
| deleted_at | timestamptz | YES | | |
| founding_interaction_id | uuid | YES | | References the interaction that founded/originated this opportunity. Tracks the initial conversation or communication that led to creating this opportunity record. Used to link opportunities back to their originating interactions for business analysis and relationship tracking. |
| stage | opportunity_stage | NO | 'New Lead'::opportunity_stage | Opportunity stage in 7-point Principal-focused sales funnel. Default: New Lead |
| opportunity_context | varchar | YES | | Context where opportunity originated: Site Visit, Food Show, New Product Interest, Follow-up, Demo Request, Sampling, Custom |
| auto_generated_name | boolean | YES | false | TRUE if opportunity name was auto-generated by system, FALSE if manually entered |
| status | opportunity_status | NO | 'Active'::opportunity_status | |
| stage_manual | boolean | NO | false | |
| status_manual | boolean | NO | false | |
| last_sync_date | timestamptz | YES | now() | |
| search_tsv | tsvector | YES | | |

## Primary Key
- opportunities_pkey: (id)

## Foreign Keys
- opportunities_contact_id_fkey: contact_id → contacts(id)
- opportunities_organization_id_fkey: organization_id → organizations(id)
- opportunities_principal_organization_id_fkey: principal_organization_id → organizations(id)
- opportunities_distributor_organization_id_fkey: distributor_organization_id → organizations(id)
- opportunities_created_by_fkey: created_by → auth.users(id)
- opportunities_updated_by_fkey: updated_by → auth.users(id)
- opportunities_founding_interaction_id_fkey: founding_interaction_id → interactions(id)

## Check Constraints
- opportunities_probability_check: probability >= 0 AND probability <= 100
- opportunities_opportunity_context_check: opportunity_context::text = ANY (ARRAY['Site Visit'::character varying, 'Food Show'::character varying, 'New Product Interest'::character varying, 'Follow-up'::character varying, 'Demo Request'::character varying, 'Sampling'::character varying, 'Custom'::character varying]::text[])

## Indexes
- opportunities_pkey: UNIQUE btree (id)
- idx_opportunities_active_stage: btree (deleted_at, stage, estimated_close_date) WHERE (deleted_at IS NULL)
- idx_opportunities_contact: btree (contact_id)
- idx_opportunities_org_active: btree (organization_id, deleted_at, stage) WHERE (deleted_at IS NULL)
- idx_opportunities_organization: btree (organization_id)
- idx_opportunities_owner_deleted: btree (created_by, deleted_at) WHERE (deleted_at IS NULL)
- idx_opportunities_priority: btree (priority) WHERE (deleted_at IS NULL)
- idx_opportunities_search_tsv: gin (search_tsv)
- idx_opportunities_stage: btree (stage, created_at DESC) WHERE (deleted_at IS NULL)

## RLS Enabled
Yes